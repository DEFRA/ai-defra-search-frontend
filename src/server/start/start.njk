{% extends "layouts/page.njk" %}

{% from "govuk/components/label/macro.njk" import govukLabel %}
{% from "govuk/components/hint/macro.njk" import govukHint %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "model-select/macro.njk" import defraModelSelect %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {% if errorMessage %}
        {{ govukErrorSummary({
          titleText: "There is a problem",
          errorList: [
            {
              text: errorMessage,
              href: "#question"
            }
          ]
        }) }}
      {% endif %}

      {% if messages %}
        <h2 class="govuk-heading-l govuk-!-margin-bottom-6">
          Here's what I found
        </h2>

        {% for message in messages %}
          {% if message.role === "user" %}
            <p class="govuk-body app-user-message">"{{ message.content }}"</p>
          {% endif %}

          {% if message.role === "assistant" %}
            <p class="govuk-body govuk-!-margin-bottom-8" style="white-space: pre-wrap;">{{ message.content }}</p>
          {% endif %}
        {% endfor %}

      {% endif %}

    </div>
  </div>

  {% if not messages %}
    <div class="app-prompt-input-container">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
          <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
            What can I help you with?
          </h1>

          <p class="govuk-hint">For example:</p>
          <ul class="govuk-list govuk-list--bullet govuk-hint govuk-!-margin-bottom-4">
            <li>Extract the key information from this meeting transcript</li>
            <li>What are the common steps in a GDS lead User Research Discovery project?</li>
          </ul>

          <form action="/start" method="post" novalidate>

            <div class="govuk-form-group">
              <label for="question" class="govuk-visually-hidden">
                What can I help you with?
              </label>

              <div class="app-question-input">
                <textarea
                  class="govuk-textarea app-auto-grow-textarea"
                  id="question"
                  name="question"
                  rows="1"
                  placeholder="Ask anything"
                >{{ question if question else "" }}</textarea>

                <button type="submit" class="app-icon-button" aria-label="Submit question">
                  <span class="app-icon-button__inner">
                    <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                      <path d="M0 12.1094C0 5.41992 5.41992 0 12.1094 0C18.7988 0 24.2188 5.41992 24.2188 12.1094C24.2188 18.7988 18.7988 24.2188 12.1094 24.2188C5.41992 24.2188 0 18.7988 0 12.1094Z" fill="#ffffff" />
                      <path d="M7.01172 13.5205L10.5469 9.83398V18.75C10.5469 19.3994 11.0693 19.9219 11.7188 19.9219H12.5C13.1494 19.9219 13.6719 19.3994 13.6719 18.75V9.83398L17.207 13.5205C17.6611 13.9941 18.418 14.0039 18.8818 13.54L19.4141 13.0029C19.873 12.5439 19.873 11.8018 19.4141 11.3477L12.9395 4.86816C12.4805 4.40918 11.7383 4.40918 11.2842 4.86816L4.7998 11.3477C4.34082 11.8066 4.34082 12.5488 4.7998 13.0029L5.33203 13.54C5.80078 14.0039 6.55762 13.9941 7.01172 13.5205Z" fill="#00703c" />
                    </svg>
                  </span>
                  <span class="govuk-visually-hidden">Submit question</span>
                </button>
              </div>
            </div>

            {{ defraModelSelect({
                    models: models
            }) }}
          </form>
        </div>
      </div>
    </div>
  {% else %}
    <div class="app-prompt-input-container">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <form action="/start" method="post" novalidate>
            <div class="govuk-form-group">
              <label for="question" class="govuk-label govuk-label--m">
                What can I help you with?
              </label>

              <div class="app-question-input">
                <textarea
                  class="govuk-textarea app-auto-grow-textarea"
                  id="question"
                  name="question"
                  rows="1"
                  placeholder=""
                >{{ question if question else "" }}</textarea>

                <button type="submit" class="app-icon-button" aria-label="Submit question">
                  <span class="app-icon-button__inner">
                    <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                      <path d="M0 12.1094C0 5.41992 5.41992 0 12.1094 0C18.7988 0 24.2188 5.41992 24.2188 12.1094C24.2188 18.7988 18.7988 24.2188 12.1094 24.2188C5.41992 24.2188 0 18.7988 0 12.1094Z" fill="#ffffff" />
                      <path d="M7.01172 13.5205L10.5469 9.83398V18.75C10.5469 19.3994 11.0693 19.9219 11.7188 19.9219H12.5C13.1494 19.9219 13.6719 19.3994 13.6719 18.75V9.83398L17.207 13.5205C17.6611 13.9941 18.418 14.0039 18.8818 13.54L19.4141 13.0029C19.873 12.5439 19.873 11.8018 19.4141 11.3477L12.9395 4.86816C12.4805 4.40918 11.7383 4.40918 11.2842 4.86816L4.7998 11.3477C4.34082 11.8066 4.34082 12.5488 4.7998 13.0029L5.33203 13.54C5.80078 14.0039 6.55762 13.9941 7.01172 13.5205Z" fill="#00703c" />
                    </svg>
                  </span>
                  <span class="govuk-visually-hidden">Submit question</span>
                </button>
              </div>
            </div>

            {{ defraModelSelect({
                    models: models
            }) }}
          </form>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
