{%- set messages = params.messages if params.messages else [] -%}
{%- set lastUserIndex = -1 -%}
{%- for message in messages -%}
  {%- if message.role === "user" -%}
    {%- set lastUserIndex = loop.index0 -%}
  {%- endif -%}
{%- endfor -%}

<div class="govuk-!-margin-bottom-6">
  <p>Chat with AI Assistant to get help with user-centred design questions.</p>
  <h3 class="govuk-heading-s">Conversation</h3>
  <div class="govuk-!-padding-4 app-conversation-container">
    {% for message in messages %}
      {% if message.role === "user" %}
        <div class="app-user-question-wrapper"{% if loop.index0 == lastUserIndex %} id="latest-question" tabindex="-1" autofocus{% endif %}>
          <div class="app-user-question">
              {{ message.content | safe }}
          </div>
        </div>
        <p class="govuk-body-s govuk-!-font-weight-bold govuk-!-text-align-right govuk-!-margin-top-0">
          You
        </p>
      {% endif %}

      {% if message.role === "assistant" %}
        <div class="app-assistant-response">
            {{ message.content | safe }}
        </div>
        <p class="govuk-body-s govuk-!-text-align-left govuk-!-margin-top-0">
          <strong>AI Assistant</strong> ({{ message.model }})
        </p>
      {% endif %}
    {% endfor %}
  </div>
</div>
